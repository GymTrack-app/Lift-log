<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>LiftLog AI Pro</title>
  <style>
    :root {
      --bg:#05040b; --panel:#0c0b18; --card:#131126; --text:#f5f4ff;
      --muted:rgba(220,218,255,.7); --accent:#b772ff; --accent2:#5be6ff;
      --danger:#ff6b81; --line:rgba(255,255,255,.1); --radius:18px;
    }
    body { 
      margin:0; background:radial-gradient(circle at top,#15122a 0,#05040b 55%);
      color:var(--text); font-family:system-ui, sans-serif; padding-bottom:100px;
    }
    .app { max-width:560px; margin:0 auto; padding:12px; }
    .screen { display:none; } .screen.show { display:block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
    .card { 
      background:linear-gradient(180deg,rgba(16,15,38,.96),rgba(7,7,18,.96));
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius);
      padding:16px; margin-bottom:12px; box-shadow:0 18px 40px rgba(0,0,0,.5);
    }
    .title { font-size:20px; font-weight:800; text-align:center; margin-bottom:20px; }
    .tiny { font-size:12px; color:var(--muted); }
    button, input, select { 
      background:rgba(10,9,24,.85); color:#fff; border:1px solid var(--line);
      padding:12px; border-radius:14px; width:100%; margin-top:8px; outline:none;
    }
    .btn-acc { background:linear-gradient(120deg,#b772ff,#5be6ff); color:#05040b; border:none; font-weight:800; cursor:pointer; }
    .tabs { 
      position:fixed; bottom:0; left:0; right:0; background:rgba(3,3,10,.96);
      backdrop-filter:blur(16px); border-top:1px solid var(--line);
      display:flex; justify-content:space-around; padding:15px 10px 30px;
    }
    .tab { font-size:11px; color:var(--muted); cursor:pointer; text-align:center; }
    .tab.active { color:var(--accent2); font-weight:bold; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
  </style>
</head>
<body>
  <div class="app">
    <div id="screenToday" class="screen show">
      <div class="title">Today</div>
      <div id="todayBox"></div>
      <div class="card">
        <div class="tiny">Quick Stats</div>
        <div class="grid2">
          <div><div class="tiny">Streak</div><b id="statStreak">0</b></div>
          <div><div class="tiny">Total</div><b id="statTotal">0</b></div>
        </div>
      </div>
    </div>

    <div id="screenSetup" class="screen">
      <div class="title">Setup Split</div>
      <div id="setupList"></div>
      <button class="btn-acc" onclick="app.addDay()">+ Add Training Day</button>
    </div>

    <div id="screenLogger" class="screen">
      <div class="title">Log Workout</div>
      <div id="logBox"></div>
      <button class="btn-acc" onclick="app.finishWorkout()">Finish & Save</button>
    </div>

    <div id="screenProgress" class="screen">
      <div class="title">History</div>
      <div id="progressList"></div>
    </div>
  </div>

  <nav class="tabs">
    <div class="tab active" id="t-Today" onclick="app.nav('screenToday')">Home</div>
    <div class="tab" id="t-Setup" onclick="app.nav('screenSetup')">Setup</div>
    <div class="tab" id="t-Progress" onclick="app.nav('screenProgress')">Prog</div>
  </nav>

  <script>
    const app = {
      state: JSON.parse(localStorage.getItem('liftlog_final_v1')) || {
        split: [], exercises: {}, sessions: [], streak: 0, activeTab: 'screenToday'
      },
      save() { 
        localStorage.setItem('liftlog_final_v1', JSON.stringify(this.state)); 
        this.render(); 
      },
      nav(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('show'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.add('show');
        document.getElementById('t-' + id.replace('screen', '')).classList.add('active');
        this.state.activeTab = id;
        this.render();
      },
      calc1RM(w, r) { return w * (1 + (r / 30)); },
      addDay() {
        const name = prompt("Day Name (e.g., Push)?");
        const day = prompt("Weekday (0=Sun, 1=Mon...)?");
        if (name) { this.state.split.push({ name, day, exs: [] }); this.save(); }
      },
      addEx(dayIdx) {
        const name = prompt("Exercise Name?");
        const weight = parseFloat(prompt("Starting Weight?")) || 0;
        const reps = parseInt(prompt("Target Reps?")) || 8;
        if (name) {
          const id = 'ex_' + Date.now();
          this.state.exercises[id] = { name, weight, targetReps: reps };
          this.state.split[dayIdx].exs.push(id);
          this.save();
        }
      },
      render() {
        // Render Today
        const dow = new Date().getDay();
        const plan = this.state.split.find(s => s.day == dow);
        document.getElementById('todayBox').innerHTML = plan ? 
          `<div class="card"><h3>${plan.name}</h3><p class="tiny">${plan.exs.length} Exercises</p><button class="btn-acc" onclick="app.nav('screenLogger')">Start Workout</button></div>` :
          `<div class="card muted">Rest Day. Build muscle while you sleep!</div>`;
        document.getElementById('statStreak').innerText = this.state.streak;
        document.getElementById('statTotal').innerText = this.state.sessions.length;

        // Render Setup
        document.getElementById('setupList').innerHTML = this.state.split.map((s, i) => `
          <div class="card">
            <b>${s.name}</b> <small class="tiny">(Day ${s.day})</small>
            <button onclick="app.addEx(${i})" style="padding:5px; margin-top:10px">+ Add Ex</button>
          </div>`).join('');

        // Render Logger
        if (this.state.activeTab === 'screenLogger' && plan) {
          document.getElementById('logBox').innerHTML = plan.exs.map(id => {
            const ex = this.state.exercises[id];
            return `<div class="card"><strong>${ex.name}</strong><br><small class="tiny">Target: ${ex.targetReps} reps @ ${ex.weight}</small>
              <input type="number" id="w-${id}" value="${ex.weight}">
              <input type="number" id="r-${id}" placeholder="Reps Done"></div>`;
          }).join('');
        }

        // Render Progress
        document.getElementById('progressList').innerHTML = this.state.sessions.slice().reverse().map(s => `
          <div class="card"><div class="tiny">${s.date}</div>
          ${s.results.map(r => `<div>${r.name}: ${r.weight} x ${r.reps}</div>`).join('')}</div>`).join('');
      },
      finishWorkout() {
        const dow = new Date().getDay();
        const plan = this.state.split.find(s => s.day == dow);
        const session = { date: new Date().toLocaleDateString(), results: [] };
        plan.exs.forEach(id => {
          const w = parseFloat(document.getElementById(`w-${id}`).value);
          const r = parseInt(document.getElementById(`r-${id}`).value);
          if (r >= this.state.exercises[id].targetReps) this.state.exercises[id].weight += 5;
          session.results.push({ name: this.state.exercises[id].name, weight: w, reps: r });
        });
        this.state.sessions.push(session);
        this.state.streak++;
        this.save();
        this.nav('screenToday');
      }
    };
    app.render();
  </script>
</body>
</html>
